{"version":3,"file":"Changelog.js","sources":["../../../src/client/components/Changelog.ts"],"sourcesContent":["import { useToggle } from '@vueuse/core'\nimport type { FunctionalComponent } from 'vue'\nimport { computed, defineComponent, h } from 'vue'\nimport { usePageData, usePageFrontmatter, usePageLang } from 'vuepress/client'\nimport type {\n  GitChangelog,\n  GitPluginFrontmatter,\n  GitPluginPageData,\n} from '../../shared/index.js'\nimport { useGitLocaleConfig } from '../composables/index.js'\nimport { VPHeader } from './VPHeader.js'\n\nimport '../styles/vars.css'\nimport '../styles/changelog.css'\n\ntype ResolvedChangelog = Omit<GitChangelog, 'date'> & { datetime: string }\n\nexport const Changelog = defineComponent({\n  name: 'Changelog',\n\n  props: {\n    /** Title of changelog */\n    title: String,\n\n    /** header level of changelog */\n    headerLevel: {\n      type: Number,\n      default: 2,\n    },\n  },\n\n  setup(props) {\n    const locale = useGitLocaleConfig()\n    const frontmatter = usePageFrontmatter<GitPluginFrontmatter>()\n    const page = usePageData<GitPluginPageData>()\n    const lang = usePageLang()\n\n    const list = computed<ResolvedChangelog[]>(() => {\n      if (frontmatter.value.changelog === false) return []\n\n      const formatter = new Intl.DateTimeFormat(lang.value, {\n        dateStyle: 'short',\n      })\n\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      return (page.value.git?.changelog ?? []).map(({ date, ...item }) => {\n        const datetime = formatter.format(date)\n        return { datetime, ...item }\n      })\n    })\n\n    const latestUpdated = computed(() => {\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      const latest = (page.value.git?.changelog ?? [])[0]\n\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (!latest) return ''\n\n      const formatter = new Intl.DateTimeFormat(lang.value, {\n        dateStyle: 'short',\n        timeStyle: 'short',\n      })\n      return formatter.format(latest.date)\n    })\n\n    const [active, toggle] = useToggle()\n\n    const ChangelogHeader: FunctionalComponent = () =>\n      h('div', { class: 'changelog-header', onClick: toggle }, [\n        h('div', { class: 'latest-updated' }, [\n          h('span', { class: 'vpi-changelog' }),\n          h('span', [locale.value.latestUpdateAt, ' ']),\n          h('span', { 'data-allow-mismatch': '' }, latestUpdated.value),\n        ]),\n        h('div', [\n          h('span', { class: 'vpi-changelog-menu' }),\n          h('span', locale.value.viewChangelog),\n        ]),\n      ])\n\n    const ReleaseTag: FunctionalComponent<{ item: ResolvedChangelog }> = ({\n      item,\n    }) =>\n      h(\n        'li',\n        { class: 'changelog release-tag' },\n        h('div', [\n          h('a', { class: 'link release-tag' }, h('code', item.tag)),\n          h('span', { 'class': 'datetime', 'data-allow-mismatch': '' }, [\n            locale.value.timeOn,\n            ' ',\n            item.datetime,\n          ]),\n        ]),\n      )\n\n    const Commit: FunctionalComponent<{ item: ResolvedChangelog }> = ({\n      item,\n    }) =>\n      h('li', { class: 'changelog commit' }, [\n        h(\n          item.commitUrl ? 'a' : 'span',\n          {\n            class: 'link hash',\n            href: item.commitUrl,\n            target: '_blank',\n            rel: 'noreferrer',\n          },\n          [h('code', item.hash.slice(0, 5))],\n        ),\n        h('span', { class: 'divider' }, '-'),\n        h('span', { class: 'message', innerHTML: item.message }),\n        h('span', { 'class': 'datetime', 'data-allow-mismatch': '' }, [\n          locale.value.timeOn || 'on',\n          ' ',\n          item.datetime,\n        ]),\n      ])\n\n    return () =>\n      list.value.length\n        ? [\n            h(VPHeader, {\n              level: props.headerLevel,\n              anchor: 'doc-changelog',\n              text: props.title || locale.value.changelog,\n            }),\n\n            h('div', { class: ['vp-changelog', { active: active.value }] }, [\n              h(ChangelogHeader),\n\n              h('ul', { class: 'changelog-list' }, [\n                list.value.map((item) =>\n                  item.tag\n                    ? h(ReleaseTag, { item, key: item.tag })\n                    : h(Commit, { item, key: item.hash }),\n                ),\n              ]),\n            ]),\n          ]\n        : null\n  },\n})\n"],"names":["Changelog","defineComponent","props","locale","useGitLocaleConfig","frontmatter","usePageFrontmatter","page","usePageData","lang","usePageLang","list","computed","formatter","date","item","latestUpdated","latest","active","toggle","useToggle","ChangelogHeader","h","ReleaseTag","Commit","VPHeader"],"mappings":"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"}